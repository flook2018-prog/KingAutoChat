<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KingAutoChat Admin</title>
<link rel="stylesheet" href="/static/style.css">
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
<div class="navbar">
    <a href="/">Chat</a>
    <a href="/settings">Line OA Settings</a>
    <a href="/profile">Profile</a>
    <a href="/pattern">Pattern</a>
</div>

<div class="container">
    <div class="chat-section">
        <div id="chat-box"></div>
        <input type="text" id="message-input" placeholder="พิมพ์ข้อความ...">
        <button onclick="sendMessage()">ส่งข้อความ</button>
    </div>
    <div class="user-info">
        <h3>ข้อมูลลูกค้า</h3>
        <div id="user-profile">
            <p>โปรไฟล์, รูป, ชื่อ, ยูส, หมายเหตุ จะขึ้นตรงนี้แบบเรียลไทม์</p>
        </div>
    </div>
</div>

<script>
var socket = io();

// รับข้อความเรียลไทม์
socket.on("new_message", function(msg){
    const chatBox = document.getElementById("chat-box");
    const div = document.createElement("div");
    div.className = msg.from_admin ? "admin-msg" : "customer-msg";
    let content = "";
    if(msg.type === "text"){
        content = msg.message;
    } else if(msg.type === "image"){
        content = `<img src="${msg.message}" style="max-width:200px;">`;
    } else if(msg.type === "sticker"){
        content = `<img src="/static/stickers/${msg.message}" style="max-width:100px;">`;
    }
    div.innerHTML = `<b>${msg.username || 'ลูกค้า'}:</b> ${content}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
});

// ส่งข้อความ
function sendMessage(){
    const input = document.getElementById("message-input");
    const msg = input.value;
    if(msg.trim() === "") return;
    const data = {user_id: "all", username: "Admin", message: msg, type:"text", from_admin:true};
    socket.emit("admin_message", data);
    input.value = "";
}
</script>
</body>
</html>
