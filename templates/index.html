<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Chat</title>
<link rel="stylesheet" href="/static/style.css">
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
<div class="navbar">
    <a href="/">หน้าแชท</a>
    <a href="/patterns">แพทเทินข้อความ</a>
    <a href="/settings">ตั้งค่า Line OA</a>
</div>

<div class="container">
    <div class="chat-section">
        <div id="chat-box"></div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" placeholder="พิมพ์ข้อความ...">
            <button id="send-btn" onclick="sendMessage()">ส่งข้อความ</button>
        </div>
    </div>

    <div class="user-info" id="user-info">
        <img src="/static/profile_placeholder.png" width="80" style="border-radius:50%;">
        <h3 id="user-name">ชื่อ: ---</h3>
        <p id="user-uid">ยูส: ---</p>
        <p id="user-note">หมายเหตุ: ---</p>
    </div>
</div>

<script>
var socket = io();
var selectedCustomer = null;

function selectCustomer(id, name) {
    selectedCustomer = id;
    document.getElementById('user-name').innerText = 'ชื่อ: ' + name;
    // TODO: fetch info & history
}

function sendMessage(){
    let input = document.getElementById('chat-input');
    let msg = input.value.trim();
    if(!msg || !selectedCustomer) return;
    fetch('/send_message', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({customer_id:selectedCustomer,message:msg})
    });
    input.value='';
}

socket.on('new_message', function(data){
    if(data.customer_id != selectedCustomer) return;
    let box = document.getElementById('chat-box');
    let div = document.createElement('div');
    div.className = data.from=='customer'?'customer-msg':'admin-msg';
    div.innerText = data.message;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
});
</script>
</body>
</html>
