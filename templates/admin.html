<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Admin Management</title>
<style>
body{font-family:sans-serif;background:#f5f5f5;padding:20px;}
table{width:100%;border-collapse:collapse;margin-bottom:20px;}
th,td{border:1px solid #ccc;padding:10px;text-align:left;}
button{padding:5px 10px;margin:2px;}
input{padding:5px;}
</style>
</head>
<body>
<h2>จัดการ Admin</h2>
<table>
<tr><th>ID</th><th>Username</th><th>Role</th><th>Action</th></tr>
<tbody id="admin-list">
{% for admin in admins %}
<tr>
    <td>{{ admin[0] }}</td>
    <td>{{ admin[1] }}</td>
    <td>{{ admin[2] }}</td>
    <td>
        <button onclick="editAdmin({{ admin[0] }})">แก้ไขรหัสผ่าน</button>
        {% if admin[2]!='super' %}
        <button onclick="deleteAdmin({{ admin[0] }})">ลบ</button>
        {% endif %}
    </td>
</tr>
{% endfor %}
</tbody>
</table>

<h3>เพิ่ม Admin ใหม่</h3>
<input type="text" id="new-username" placeholder="Username">
<input type="password" id="new-password" placeholder="Password">
<button id="add-admin-btn">เพิ่ม Admin</button>
<a href="/" style="margin-left:20px;color:red;">กลับ Dashboard</a>

<script>
function editAdmin(id){
    const pwd = prompt("กรอกรหัสผ่านใหม่");
    if(!pwd) return;
    fetch(`/edit_admin/${id}`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({password:pwd})
    }).then(r=>r.json()).then(res=>{
        if(res.status=='ok') alert("แก้ไขรหัสผ่านเรียบร้อย");
        else alert(res.message);
    });
}

function deleteAdmin(id){
    if(!confirm("ต้องการลบ Admin นี้?")) return;
    fetch(`/delete_admin/${id}`,{
        method:'DELETE'
    }).then(r=>r.json()).then(res=>{
        if(res.status=='ok') location.reload();
        else alert(res.message);
    });
}

document.getElementById('add-admin-btn').addEventListener('click', ()=>{
    const username = document.getElementById('new-username').value;
    const password = document.getElementById('new-password').value;
    if(!username || !password) return alert("กรอกข้อมูลให้ครบ");
    fetch('/add_admin',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({username,password})
    }).then(r=>r.json()).then(res=>{
        if(res.status=='ok') location.reload();
        else alert(res.message);
    });
});
</script>
</body>
</html>
